<!-- BEGIN_TF_DOCS -->
<!-- Code generated by terraform-docs. DO NOT EDIT. -->
# Default Example

This example demonstrates how to deploy Azure CloudShell with Virtual Network integration using this AVM pattern module.

## Overview

This example will create:

- A new Resource Group
- A new Virtual Network (10.0.0.0/16)
- CloudShell infrastructure including:
  - 3 subnets (container, relay, storage) using /28 address spaces
  - Network Security Groups for each subnet
  - Storage Account with TLS 1.2 and HTTPS enforcement
  - File Share for CloudShell user data
  - Azure Relay Namespace
  - Private Endpoint for secure relay communication
  - Network Profile for container instances

## Prerequisites

Before deploying this example, ensure you have:

1. Azure CLI installed and authenticated
2. Terraform >= 1.9 installed
3. Appropriate Azure subscription permissions to create resources

## Usage

1. Clone this repository and navigate to this example directory
2. Initialize Terraform:
   ```bash
   terraform init
   ```
3. Review the planned changes:
   ```bash
   terraform plan
   ```
4. Deploy the resources:
   ```bash
   terraform apply
   ```

## Customization

You can customize the deployment by modifying the `main.tf` file:

- **Subnet addressing**: Adjust the subnet address prefixes to fit your network design
- **Storage configuration**: Modify storage account tier, replication type, or file share quota
- **Private DNS Zone**: Uncomment and provide an existing Private DNS Zone ID if you have one
- **Tags**: Add or modify tags to match your organization's standards

## Testing CloudShell

After deployment:

1. Navigate to the Azure Portal
2. Open CloudShell (icon in the top navigation bar)
3. When prompted, select "Advanced settings"
4. Choose the Storage Account and File Share created by this module
5. Select the region where resources were deployed
6. CloudShell will now use the private VNet configuration

## Cleanup

To remove all resources created by this example:

```bash
terraform destroy
```

**Note**: Before destroying, ensure no active CloudShell sessions are using the Network Profile. You may need to wait 30 minutes to several hours after disconnecting from CloudShell for the container instance to be automatically deleted by Azure.

```hcl
terraform {
  required_version = ">= 1.9"

  required_providers {
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~> 4.0"
    }
    random = {
      source  = "hashicorp/random"
      version = "~> 3.5"
    }
  }
}

provider "azurerm" {
  features {}
}

## Section to provide a random Azure region for the resource group
# This allows us to randomize the region for the resource group.
module "regions" {
  source  = "Azure/avm-utl-regions/azurerm"
  version = "0.9.0"
}

# This allows us to randomize the region for the resource group.
resource "random_integer" "region_index" {
  max = length(module.regions.regions) - 1
  min = 0
}
## End of section to provide a random Azure region for the resource group

# This ensures we have unique CAF compliant names for our resources.
module "naming" {
  source  = "Azure/naming/azurerm"
  version = "0.4.2"
}

# Create a resource group for the example VNet
resource "azurerm_resource_group" "this" {
  location = module.regions.regions[random_integer.region_index.result].name
  name     = module.naming.resource_group.name_unique
}

# Create an example Virtual Network
resource "azurerm_virtual_network" "this" {
  location            = azurerm_resource_group.this.location
  name                = module.naming.virtual_network.name_unique
  resource_group_name = azurerm_resource_group.this.name
  address_space       = ["10.0.0.0/16"]
}

# Generate a random string for unique storage account name
resource "random_string" "storage_suffix" {
  length  = 8
  lower   = true
  numeric = true
  special = false
  upper   = false
}

# Deploy CloudShell with VNet Integration
module "cloudshell_vnet" {
  source = "../../"

  container_subnet_address_prefix = "10.0.1.0/28"
  # Location (will use VNet location if not specified)
  location = azurerm_resource_group.this.location
  # Relay Namespace
  relay_namespace_name        = "cloudshell-relay-${random_string.storage_suffix.result}"
  relay_subnet_address_prefix = "10.0.1.16/28"
  # Storage Account Configuration
  storage_account_name          = "cloudshell${random_string.storage_suffix.result}"
  storage_subnet_address_prefix = "10.0.1.32/28"
  # Existing Virtual Network
  virtual_network_name                = azurerm_virtual_network.this.name
  virtual_network_resource_group_name = azurerm_virtual_network.this.resource_group_name
  # Subnet Configuration (using /28 subnets as recommended)
  container_subnet_name = "cloudshell-containers"
  # Enable telemetry (AVM requirement)
  enable_telemetry    = var.enable_telemetry
  file_share_name     = "cloudshell"
  file_share_quota_gb = 6
  # Private Endpoint
  private_endpoint_name = "cloudshell-relay-pe"
  relay_subnet_name     = "cloudshell-relay"
  storage_subnet_name   = "cloudshell-storage"
  # Tags
  tags = {
    Environment = "Example"
    Purpose     = "CloudShell-VNet-Demo"
  }
}
```

<!-- markdownlint-disable MD033 -->
## Requirements

The following requirements are needed by this module:

- <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) (>= 1.9)

- <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) (~> 4.0)

- <a name="requirement_random"></a> [random](#requirement\_random) (~> 3.5)

## Resources

The following resources are used by this module:

- [azurerm_resource_group.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group) (resource)
- [azurerm_virtual_network.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_network) (resource)
- [random_integer.region_index](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/integer) (resource)
- [random_string.storage_suffix](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/string) (resource)

<!-- markdownlint-disable MD013 -->
## Required Inputs

No required inputs.

## Optional Inputs

The following input variables are optional (have default values):

### <a name="input_enable_telemetry"></a> [enable\_telemetry](#input\_enable\_telemetry)

Description: This variable controls whether or not telemetry is enabled for the module.  
For more information see <https://aka.ms/avm/telemetryinfo>.  
If it is set to false, then no telemetry will be collected.

Type: `bool`

Default: `true`

## Outputs

The following outputs are exported:

### <a name="output_container_subnet_id"></a> [container\_subnet\_id](#output\_container\_subnet\_id)

Description: The resource ID of the CloudShell container subnet.

### <a name="output_location"></a> [location](#output\_location)

Description: The Azure region where resources were deployed.

### <a name="output_network_profile_id"></a> [network\_profile\_id](#output\_network\_profile\_id)

Description: The resource ID of the Network Profile for CloudShell.

### <a name="output_network_profile_name"></a> [network\_profile\_name](#output\_network\_profile\_name)

Description: The name of the Network Profile.

### <a name="output_private_endpoint_id"></a> [private\_endpoint\_id](#output\_private\_endpoint\_id)

Description: The resource ID of the Private Endpoint for the Relay Namespace.

### <a name="output_relay_namespace_id"></a> [relay\_namespace\_id](#output\_relay\_namespace\_id)

Description: The resource ID of the Azure Relay Namespace.

### <a name="output_relay_namespace_name"></a> [relay\_namespace\_name](#output\_relay\_namespace\_name)

Description: The name of the Azure Relay Namespace.

### <a name="output_resource_group_name"></a> [resource\_group\_name](#output\_resource\_group\_name)

Description: The name of the resource group containing the resources.

### <a name="output_storage_account_id"></a> [storage\_account\_id](#output\_storage\_account\_id)

Description: The resource ID of the Storage Account.

### <a name="output_storage_account_name"></a> [storage\_account\_name](#output\_storage\_account\_name)

Description: The name of the Storage Account for CloudShell.

### <a name="output_virtual_network_id"></a> [virtual\_network\_id](#output\_virtual\_network\_id)

Description: The resource ID of the virtual network.

### <a name="output_virtual_network_name"></a> [virtual\_network\_name](#output\_virtual\_network\_name)

Description: The name of the virtual network.

## Modules

The following Modules are called:

### <a name="module_cloudshell_vnet"></a> [cloudshell\_vnet](#module\_cloudshell\_vnet)

Source: ../../

Version:

### <a name="module_naming"></a> [naming](#module\_naming)

Source: Azure/naming/azurerm

Version: 0.4.2

### <a name="module_regions"></a> [regions](#module\_regions)

Source: Azure/avm-utl-regions/azurerm

Version: 0.9.0

<!-- markdownlint-disable-next-line MD041 -->
## Data Collection

The software may collect information about you and your use of the software and send it to Microsoft. Microsoft may use this information to provide services and improve our products and services. You may turn off the telemetry as described in the repository. There are also some features in the software that may enable you and Microsoft to collect data from users of your applications. If you use these features, you must comply with applicable law, including providing appropriate notices to users of your applications together with a copy of Microsoftâ€™s privacy statement. Our privacy statement is located at <https://go.microsoft.com/fwlink/?LinkID=824704>. You can learn more about data collection and use in the help documentation and our privacy statement. Your use of the software operates as your consent to these practices.
<!-- END_TF_DOCS -->